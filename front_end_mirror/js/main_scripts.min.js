!function(){angular.module("mirrorApp",[]).controller("mirror",["$scope","confService","speechService","keyService",function(e,t,i,n){function o(t){t&&t.on_off&&t.on_off.value&&("on"!=t.on_off.value||e.showAll?"off"==t.on_off.value&&e.showAll&&(e.showAll=!1):e.showAll=!0)}function r(){c+=1,c>=p.value.length&&(c=0),u(p,!0)}e.apps=[],e.showAll=!1,e.loader=!0,e.showUser=!1,e.username="user 1";const a=1e4,l=5e3,s=5e3;var p,f,c=0,u=function(i,n){p=i,i?(0==e.apps.length||n?(e.apps=i.value[c].Apps,e.loader=!1,e.showAll=!0,e.username="user "+p.value[c].MemberName,e.showUser=!0,clearTimeout(f),f=setTimeout(function(){e.showUser=!1},s)):(t.addDeleteApps(i.value[c].Apps,e.apps),t.changeVals(i.value[c].Apps,e.apps),e.$broadcast("update",i.value[c].Apps)),setTimeout(y,a)):setTimeout(y,l)},m=function(e,t,i,n){console.log(e,t,i,n)},y=function(){t.getConf(u,m)};e.keyUpEvent=function(e){n.keyUpPressed(e)},n.registerKey("83","cycleUser",r),i.registerSpeechFunction("clear","main",o),i.init(),y()}]),angular.module("mirrorApp").config(["$controllerProvider","$provide","$compileProvider","$httpProvider",function(e,t,i,n){angular.module("mirrorApp")._controller=angular.module("mirrorApp").controller,angular.module("mirrorApp")._service=angular.module("mirrorApp").service,angular.module("mirrorApp")._factory=angular.module("mirrorApp").factory,angular.module("mirrorApp")._value=angular.module("mirrorApp").value,angular.module("mirrorApp")._directive=angular.module("mirrorApp").directive,angular.module("mirrorApp").controller=function(t,i){return e.register(t,i),this},angular.module("mirrorApp").service=function(e,i){return t.service(e,i),this},angular.module("mirrorApp").factory=function(e,i){return t.factory(e,i),this},angular.module("mirrorApp").value=function(e,i){return t.value(e,i),this},angular.module("mirrorApp").directive=function(e,t){return i.directive(e,t),this},n.defaults.transformRequest=[function(e){var t=function(e){var i,n,o,r,a,l,s,p="";for(i in e)if(n=e[i],n instanceof Array)for(s=0;s<n.length;++s)a=n[s],o=i+"["+s+"]",l={},l[o]=a,p+=t(l)+"&";else if(n instanceof Object)for(r in n)a=n[r],o=i+"["+r+"]",l={},l[o]=a,p+=t(l)+"&";else void 0!==n&&null!==n&&(p+=encodeURIComponent(i)+"="+encodeURIComponent(n)+"&");return p.length?p.substr(0,p.length-1):p};return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}])}(),function(){angular.module("mirrorApp").factory("authService",["dataService",function(e){function t(t){e.postData(n.req,function(e){localStorage.setItem("AI",JSON.stringify(e)),t()},t)}function i(){var e=JSON.parse(localStorage.getItem("AI"));return n.checkAuhtInfo(e)?e.access_token:null}var n={},o={auth:t,getToken:i};return n.checkAuhtInfo=function(e){if(e&&e.access_token&&e[".expires"]){var t=new Date(e[".expires"]),i=(new Date).setTime((new Date).getTime()+864e5);return t-i>0?!0:(console.log("Token expired, need new token"),!1)}return!1},n.req={method:"POST",url:"http://apimate.azurewebsites.net/Token",headers:{"Content-Type":"x-www-form-urlencoded"},data:{grant_type:"password",username:"test1@gmail.com",password:"test1234"}},o}])}(),function(){angular.module("mirrorApp").factory("confService",["tempConfLib","authService","dataService",function(e,t,i){function n(i,n,o){o||(o=0),t.getToken()?l.getConf(i,n):3>o?(o+=1,t.auth(function(){s.getConf(i,n,o)})):l.makeConfig(e,i)}function o(e,t){for(var i in t){var n=a(e,t[i].Name);n&&(t[i].pLeft=n.pLeft,t[i].pTop=n.pTop,t[i].Theme=n.Theme,t[i].Orientation=n.Orientation)}}function r(e,t){for(var i in e)a(t,e[i].Name)||t.push(e[i]);for(var i in t){var n=null;for(var o in e)t[i].Name==e[o].Name&&(n=1);n||t.splice(i,1)}}function a(e,t){for(var i in e)if(e[i].Name==t)return e[i];return null}var l={},s={getConf:n,changeVals:o,getAppByName:a,addDeleteApps:r};return l.addFixedToConf=function(e){for(index in e.value)e.value[index].Apps.push({ID:0,pTop:"300px",pLeft:"0px",Name:"recorder",Theme:"Theme1",Orientation:0});return e},l.setConfig=function(e,t){sConf=l.addFixedToConf(e);var i=JSON.stringify(sConf);localStorage&&localStorage.setItem("mirror_conf",i),t(sConf)},l.getConf=function(e,t){var i;localStorage&&(i=localStorage.getItem("mirror_conf"),i=JSON.parse(i));var n={local:!1,value:null,last_updated:null};i?!i.last_updated||new Date(i.last_updated)-(new Date).setSeconds((new Date).getSeconds()-10)<0?this.loadNewConfig(e,t):(n.value=i.value,n.local=!0,l.setConfig(n,e)):this.loadNewConfig(e,t)},l.makeConfig=function(e,t){var i={};i.value=e,i.local=!1,i.last_updated=new Date,l.setConfig(i,t)},l.loadNewConfig=function(e,n){conf=localStorage.getItem("mirror_conf");var o=null;conf&&(conf=JSON.parse(conf),o=conf.last_updated);var r={method:"POST",url:"https://apimate.azurewebsites.net/api/config/mirror",headers:{Authorization:"Bearer "+t.getToken(),"Content-Type":"application/json"},data:JSON.stringify({userID:"",key:"",last_updated:o})};i.postData(r,function(t){l.makeConfig(t,e)},n)},s}])}(),function(){angular.module("mirrorApp").factory("dataService",["$http",function(e){function t(t,i,n,o){e.get(encodeURI(t)).success(function(e,t,n,r){i&&i(e,t,n,r,o)}).error(function(e,t,i,r){n&&n(e,t,i,r,o)})}function i(t,i,n,o){e.post(encodeURI(t),i).success(function(e,t,i,o){n&&n(e,t,i,o)}).error(function(e,t,i,n){o&&o(e,t,i,n)})}function i(t,i,n){e(t).success(function(e,t,n,o){i&&i(e,t,n,o)}).error(function(e,t,i,o){n&&n(e,t,i,o)})}function n(e,t,i){$.feedToJson({feed:e,success:function(e){t&&t(e)},error:function(e){i&&i(e)}})}function o(e){for(var t,e=JSON.stringify(e),i=r.extensionLib.length-1;!t&&i>=0;)-1!=e.indexOf(r.extensionLib[i])&&(t=r.getUrlFromPosition(e,r.extensionLib[i])),i--;return t}var r={},a={getData:t,postData:i,getJSONFromXML:n,getUrlFromRSS:o};return r.extensionLib=[".jpg",".png",".gif",".jpeg",".tiff",".svg"],r.getUrlFromPosition=function(e,t){var i=e.indexOf(t),n=i+t.length,o=e.substring(0,n),r=o.lastIndexOf('"'),a=o.slice(r+1);return a},a}])}(),function(){angular.module("mirrorApp").factory("keyService",["speechService","$rootScope",function(e,t){function i(e){console.log(e.keyCode),r.lib[""+e.keyCode]&&r.lib[""+e.keyCode].func()}function n(e,t,i){r.lib[e]={name:t,func:i,status:!0}}function o(){r.lib[77].status=e.startStopMic(r.lib[77].status)}var r={},a={keyUpPressed:i,registerKey:n};return r.lib={77:{name:"speech",func:o,status:!1},67:{name:"compliment",func:function(){t.showCompliment()},status:!0}},a}])}(),function(){angular.module("mirrorApp").factory("mainFormatService",[function(){function e(e){var t;if(e>60){var n=Math.floor(e/60),o=e%60;if(n>60){var r=Math.floor(n/60),n=n%60;if(r>24)var a=Math.floor(r/24);var r=r%24}}else var o=e;return void 0!=o&&void 0!=n&&void 0!=r&&void 0!=a?t=i.tdf(a)+":"+i.tdf(r)+":"+i.tdf(n)+":"+i.tdf(o):void 0!=o&&void 0!=n&&void 0!=r?t=i.tdf(r)+":"+i.tdf(n)+":"+i.tdf(o):void 0!=o&&void 0!=n?t=i.tdf(n)+":"+i.tdf(o):void 0!=o&&(t="00:"+i.tdf(o)),t?t:null}function t(e){function t(e){return 10>e?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"}var i={},n={formatTime:e,ISODateString:t};return i.tdf=function(e){return void 0!=e&&(""+e).length<2?"0"+e:e},n}])}(),function(){angular.module("mirrorApp").factory("speechService",["$rootScope","confService","talkService",function(e,t,i){function n(){l.mic=new Wit.Microphone,l.info=function(e){console.log("info",e)},l.error=function(e){console.log("err:",e)},l.mic.onready=function(){l.info("Microphone is ready to record")},l.mic.onaudiostart=function(){l.info("Recording started")},l.mic.onaudioend=function(){l.info("Recording stopped, processing started")},l.mic.onresult=function(e,t){l.lib[e]?l.lib[e].func(t):console.log("function does not exist for the command: "+e)},l.mic.onerror=function(e){l.error("Error: "+e)},l.mic.onconnecting=function(){l.info("Microphone is connecting"),setTimeout(function(){window.parent.postMessage({speech:!0},"http://localhost:3333")},7e3)},l.mic.ondisconnected=function(){l.info("Microphone is not connected"),l.connect(2e3)},l.connect(1e4)}function o(e){return e?(l.mic.start(),l.micLib[e]()):(l.mic.stop(),l.micLib[e]()),!e}function r(e,t,i){l.lib[e]={appName:t,func:i}}function a(e,t){l.micLib[!0]=e,l.micLib[!1]=t}var l={},s={init:n,startStopMic:o,registerSpeechFunction:r,registerMic:a};return l.connect=function(e){setTimeout(function(){l.mic.connect("7YH3Q2CYLASQKAV6NHURHPZOQTFYA47N")},e)},l.lib={hello:{appName:"main",func:function(e){i.talk("Hello everyone, I'm the mirror mate. Nice to meet you")}},whatami:{appName:"main",func:function(e){i.talk("I'm a smart mirror that shows useful information on top of your awesome reflection.")}},thankyou:{appName:"main",func:function(e){i.talk("You're welcome!")}}},l.micLib={"true":function(){console.log("mic still initializing ...")},"false":function(){console.log("mic still initializing ...")}},s}])}(),function(){angular.module("mirrorApp").factory("talkService",[function(e,t){var i={};return i.talk=function(e){window.parent.postMessage({voice:{value:e}},"http://localhost:3333")},i}])}(),function(){angular.module("mirrorApp").factory("keyLib",["$rootScope",function(e){var t={};return t.listen=function(){t.lib[77].status=speechService.startStopMic(t.lib[77].status)},t.lib=null,t.lib}])}(),function(){angular.module("mirrorApp").factory("styleLib",[function(e){var t={};return t.style1=[{featureType:"all",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"geometry",stylers:[{color:"#4d1111"},{visibility:"on"}]},{featureType:"administrative",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#ffffff"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#ffffff"}]},{featureType:"administrative.locality",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"administrative.locality",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"administrative.locality",elementType:"geometry.stroke",stylers:[{visibility:"on"}]},{featureType:"administrative.locality",elementType:"labels.text",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#bbbbbb"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"on"},{color:"#000000"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",elementType:"all",stylers:[{visibility:"off"},{color:"#080000"}]},{featureType:"landscape.natural.landcover",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#ffffff"},{saturation:"0"}]},{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#99d7e3"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],t}])}(),function(){angular.module("mirrorApp").factory("tempConfLib",[function(){return[{ID:1,isActive:!0,MeberID:1,MemberName:"Member1",Apps:[{ID:1,ConfigID:1,Data:JSON.stringify({TimeZone:"TOBEADDED"}),isActive:!0,Name:"time",pTop:"0px",pLeft:"0px"},{ID:2,ConfigID:2,Data:JSON.stringify({URL:"https://www.googleapis.com/calendar/v3/calendars/njseea92o8odc971dgunvtoaco%40group.calendar.google.com/events?&key=AIzaSyAawABJun_uk9-j10X9KxlI07r56bf7s-4"}),Name:"calendar",isActive:!0,pTop:"0px",pLeft:"1440px"},{ID:3,ConfigID:3,Data:JSON.stringify({Location:"Kortrijk,be"}),isActive:!0,Name:"weather",pTop:"318px",pLeft:"0px"},{ID:4,ConfigID:4,Data:JSON.stringify({URL:"http://feeds.nieuwsblad.be/nieuws/snelnieuws?format=xml"}),isActive:!0,Name:"news",pTop:"689px",pLeft:"1440px"},{ID:5,ConfigID:5,Data:JSON.stringify({text:"Welcome to the future of IT"}),isActive:!0,Name:"compliment",pLeft:"562px",pTop:"515px"},{ID:500,ConfigID:500,Data:JSON.stringify({items:["Don't forget to take out the trash!","Can you bring milk from the store?","Pay the bills"]}),isActive:!0,Name:"reminders",pTop:"950px",pLeft:"684px"},{ID:222,ConfigID:222,Data:JSON.stringify(null),isActive:!0,Name:"timer",pTop:"53px",pLeft:"836px"},{ID:444,ConfigID:444,Data:JSON.stringify(null),isActive:!0,Name:"qod",pTop:"918px",pLeft:"0px"}]},{ID:2,isActive:!0,MeberID:2,MemberName:"Member2",Apps:[{ID:1,ConfigID:1,Data:JSON.stringify({TimeZone:"TOBEADDED"}),isActive:!0,Name:"time",pTop:"0px",pLeft:"0px"},{ID:2,ConfigID:2,Data:JSON.stringify({URL:"https://www.googleapis.com/calendar/v3/calendars/njseea92o8odc971dgunvtoaco%40group.calendar.google.com/events?&key=AIzaSyAawABJun_uk9-j10X9KxlI07r56bf7s-4"}),Name:"calendar",isActive:!0,pTop:"0px",pLeft:"1440px"},{ID:3,ConfigID:3,Data:JSON.stringify({Location:"Kortrijk,be"}),isActive:!0,Name:"weather",pTop:"318px",pLeft:"0px"},{ID:4,ConfigID:4,Data:JSON.stringify({URL:"http://www.hln.be/rss.xml"}),isActive:!0,Name:"news",pTop:"689px",pLeft:"1440px"},{ID:5,ConfigID:5,Data:JSON.stringify({text:"Welcome to the future of IT"}),isActive:!0,Name:"compliment",pLeft:"562px",pTop:"515px"},{ID:500,ConfigID:500,Data:JSON.stringify({items:["Don't forget to take out the trash!","Can you bring milk from the store?","Pay the bills"]}),isActive:!0,Name:"reminders",pTop:"950px",pLeft:"684px"},{ID:222,ConfigID:222,Data:JSON.stringify(null),isActive:!0,Name:"timer",pTop:"53px",pLeft:"0px"},{ID:333,ConfigID:333,Data:JSON.stringify({from:"Graaf Karel de Goedelaan 38, Kortrijk",to:"Kontich, veldkant 33A"}),isActive:!0,Name:"traffic",pTop:"864px",pLeft:"0px"}]}]}])}(),function(){angular.module("mirrorApp").directive("myApp",["confService",function(e){return{restrict:"E",scope:{app:"=app",apps:"=apps"},templateUrl:"./app/directives/appDirective/my-app.html",link:function(t,i){t.update={},t.update.func=function(){},i.css("top",t.app.pTop),i.css("left",t.app.pLeft),t.app.Data&&(t.app.Data=JSON.parse(t.app.Data));var n=t.app.Name.toLowerCase(),o=t.app.Theme.toLowerCase(),r=t.app.Orientation;t.app.appSrc="./app/apps/"+n+"/"+o+"/"+n+r+".html",t.$watch("app.pTop",function(e){i.css("top",e)}),t.$watch("app.pLeft",function(e){i.css("left",e)}),t.$watch("app.Theme",function(e){o=e,t.app.appSrc="./app/apps/"+n+"/"+o+"/"+n+r+".html"}),t.$watch("app.Orientation",function(e){r=e,t.app.appSrc="./app/apps/"+n+"/"+o+"/"+n+r+".html"}),t.$on("update",function(i,n){var o=e.getAppByName(n,t.app.Name);o&&"function"==typeof t.update.func&&t.update.func(o)})}}}])}(),function(){angular.module("mirrorApp").directive("myErrSrc",function(){return{scope:{myErrSrc:"="},link:function(e,t,i){t.bind("error",function(){i.src!=i.myErrSrc&&i.$set("src",i.myErrSrc)}),i.$observe("ngSrc",function(e){!e&&i.errSrc?i.$set("src",i.myErrSrc):e||t.css("display","none")})}}})}(),function(){angular.module("mirrorApp").directive("myLinuxInputDirective",[function(){return{restrict:"A",scope:{trigger:"=focus"},link:function(e,t){e.$watch("trigger",function(i){1==i&&(t[0].focus(),e.trigger=!1)})}}}])}(),function(){angular.module("mirrorApp").directive("myTemp",[function(){return{restrict:"E",scope:{temp:"=temp",pre:"=pre"},templateUrl:"./app/directives/tempDirective/my-temp.html"}}])}(),function(){angular.module("mirrorApp").directive("myHw",[function(){return{restrict:"E",scope:{hum:"=hum",wind:"=wind"},templateUrl:"./app/directives/wind_humidityDirective/my-wind_hum.html"}}])}();